#!/bin/bash

set -o pipefail

# Golang
export GOPATH="${HOME}/go"
export PATH="${HOME}/bin:/usr/local/bin:/usr/local/go/bin:${PATH}:${GOPATH//://bin:}/bin:/usr/share/bcc/tools:/sbin"
export GOENV_ROOT="${HOME}/.goenv"
export PATH="${GOENV_ROOT}/bin:${PATH}"
command -v goenv > /dev/null && eval "$(goenv init -)"
command -v gocomplete > /dev/null && complete -C gocomplete go

export RIPGREP_CONFIG_PATH="${HOME}/.ripgrep"

# update path for gnu coreutils, make & find on darwin
export PATH=/usr/local/opt/coreutils/libexec/gnubin:${PATH}
export MANPATH=/usr/local/opt/coreutils/libexec/gnuman:${MANPATH}
export PATH=/usr/local/opt/make/libexec/gnubin:${PATH}
export MANPATH=/usr/local/opt/make/libexec/gnuman:${MANPATH}
export PATH=/usr/local/opt/findutils/libexec/gnubin:${PATH}
export MANPATH=/usr/local/opt/findutils/libexec/gnuman:${MANPATH}

# macOS Homebrew bash completion
if [[ -f /usr/local/etc/bash_completion ]]; then
  # shellcheck disable=SC1090,SC1091
  source /usr/local/etc/bash_completion
fi

# Rust
export PATH="${PATH}:${HOME}/.cargo/bin"

# Ruby
export PATH="${PATH}:${HOME}/.rbenv/bin"

# Python
export PYENV_ROOT="${HOME}/.pyenv"
export PATH="${PYENV_ROOT}/bin:${PATH}"
command -v pyenv > /dev/null && eval "$(pyenv init -)"
command -v pyenv-virtualenv > /dev/null && eval "$(pyenv virtualenv-init -)"

# Terraform
export PATH="$HOME/.tfenv/bin:$PATH"
command -v terraform > /dev/null && complete -C $(which terraform) terraform

# Google Cloud SDK
[[ -f "${HOME}/google-cloud-sdk/path.bash.inc" ]] && source "${HOME}/google-cloud-sdk/path.bash.inc"
[[ -f "${HOME}/google-cloud-sdk/completion.bash.inc" ]] && source "${HOME}/google-cloud-sdk/completion.bash.inc"

# AWS CLI
command -v aws_completer > /dev/null && complete -C 'aws_completer' aws

# Bazel
[[ -f "${HOME}/.bazel/bin/bazel-complete.bash" ]] && . "${HOME}/.bazel/bin/bazel-complete.bash"

# Kubernetes
if command -v kubectl > /dev/null; then
  # shellcheck disable=SC1090,SC1091
  source <(kubectl completion bash)
fi

# k8s.io/kubernetes etcd
export PATH="${PATH}:${GOPATH}/src/k8s.io/kubernetes/third_party/etcd"

# Kops
if command -v kops > /dev/null; then
  # shellcheck disable=SC1090,SC1091
  source <(kops completion bash)
fi

# fzf
# shellcheck disable=SC1090,SC1091
[[ -f ~/.fzf.bash ]] && source ~/.fzf.bash

# Node
export NVM_DIR="${HOME}/.nvm"
mkdir -p "$NVM_DIR"
[[ -s "${NVM_DIR}/nvm.sh" ]] && \. "${NVM_DIR}/nvm.sh"  # This loads nvm
[[ -s "${NVM_DIR}/bash_completion" ]] && \. "${NVM_DIR}/bash_completion"  # This loads nvm bash_completion
if command -v yarn > /dev/null; then
  export PATH="${PATH}:$(yarn global bin)"
fi

# Ruby
command -v rbenv > /dev/null && eval "$(rbenv init -)"

# Java
JAVA="java"
if command -v ${JAVA} > /dev/null; then
  command -v javac > /dev/null && JAVA="javac"
  export JAVA_HOME=${JAVA_HOME-"$(dirname $(dirname $(readlink -f $(which $JAVA))))"}
fi

[[ -f /usr/local/etc/bash_completion ]] && . /usr/local/etc/bash_completion
