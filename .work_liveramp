#!/bin/bash

source "${HOME}/.liveramp_profile"

export WORKSPACE="${HOME}/workspace"
export GOPATH="${WORKSPACE}"
export PATH="${PATH}:/usr/local/go/bin:${GOPATH}/bin:${GOPATH}/wbin"

# Flyway setup.
export PATH=$PATH:$HOME/flyway

# Setup POSTGRES interaction
export PGHOST=$(kubectl get svc postgresql -o 'jsonpath={.spec.clusterIP}')
export PGPORT=$(kubectl get svc postgresql -o 'jsonpath={.spec.ports[0].port}')
export PGUSER="postgres"
export PGDATABASE="postgres"
export PGPASSWORD="password"
export PGSSLMODE="disable"

if [ ! -d "${HOME}/.kube" ]; then
  echo -e "Kube config not found. Running setup-gcloud.sh"
  "${WORKSPACE}/scripts/setup-gcloud.sh"
fi

# Terraform
if [[ -f /usr/local/share/chtf/chtf.sh ]]; then
  source "/usr/local/share/chtf/chtf.sh"
  chtf 0.8.8
fi

