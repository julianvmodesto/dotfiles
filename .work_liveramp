#!/bin/bash

if [[ -f "${HOME}/.liveramp_profile" ]]; then
  source "${HOME}/.liveramp_profile"
fi

if [[ -f "${HOME}/.work_secrets" ]]; then
  source "${HOME}/.work_secrets"
fi

export PATH="${PATH}:${HOME}/liveramp-bin"

export WORKSPACE="${HOME}/workspace"
export GOPATH="${WORKSPACE}"
export PATH="${GOPATH}/bin:${GOPATH}/wbin:${PATH}"
# export CGO_CPPFLAGS="-I/usr/local/include"
# export CGO_LDFLAGS="-L/usr/local/lib"

# Flyway setup.
export PATH=$PATH:$HOME/flyway

if [ ! -d "${HOME}/.kube" ]; then
  echo -e "Kube config not found. Running setup-gcloud.sh"
  "${WORKSPACE}/scripts/setup-gcloud.sh"
fi

git config --global user.email julian.modesto@liveramp.com
git config --global hub.host git.liveramp.net

complete -F _make wmake
complete -F _make ./wmake
if command -v _completion_loader > /dev/null; then
  _completion_loader make
fi

mac_docker() {
  # Insert Docker into your shell using minikube.
  status=$(minikube status --format={{.ClusterStatus}} 2>/dev/null)
  if [ "$status" == "Running" ]; then
    eval $(minikube docker-env)
  fi
}

case "$(uname)" in
  Darwin)
    # Start Docker on shell startup, if possible. Don't want to make it part of
    # precmd() because even the no-op takes a long time.
    mac_docker
  ;;
esac

jump_to() {
  r=$1; shift
  e=$1; shift
  ssh -At $(curl -s http://consul-server01.liveramp.net:8500/v1/kv/aws/$r/$e/bastion?raw) $*
}

